name: Pull Request Checks

on:
  pull_request:
    branches: [ main ]

jobs:
  pr-checks:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v5
        
      - name: Echo PR information
        run: |
          echo "🔍 Running pull request checks..."
          echo "PR Number: ${{ github.event.number }}"
          echo "PR Title: ${{ github.event.pull_request.title }}"
          echo "Author: ${{ github.event.pull_request.user.login }}"
          
      - name: Setup Docker Buildx
        uses: docker/setup-buildx-action@v3
        
      - name: Run basic validation
        run: |
          echo "✅ Starting validation checks..."
          echo "📝 Checking for README file..."
          if [ -f README.md ]; then
            echo "✅ README.md found"
          else
            echo "❌ README.md not found"
            exit 1
          fi
          
      - name: Build Backend Docker Image
        run: |
          echo "🐳 Building backend Docker image..."
          docker build -f backend/Dockerfile -t delbot-backend:pr-${{ github.event.number }} .
          echo "✅ Backend Docker image built successfully"
          
      - name: Build Frontend Docker Image
        run: |
          echo "🐳 Building frontend Docker image..."
          docker build -f frontend/Dockerfile -t delbot-frontend:pr-${{ github.event.number }} .
          echo "✅ Frontend Docker image built successfully"
          
      - name: Docker Images Info
        run: |
          echo "📋 Docker images created:"
          docker images | grep delbot
          echo "🔍 Image sizes:"
          docker images --format "table {{.Repository}}\t{{.Tag}}\t{{.Size}}" | grep delbot
          
      - name: Final check
        run: |
          echo "🎉 All pull request checks completed successfully!"
          echo "✅ Code builds successfully"
          echo "✅ Docker images build successfully"
          echo "✅ Ready for review"
